{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { NodeTypes } from \"./ast\";\n\nfunction createParserContext(template) {\n  return {\n    line: 1,\n    column: 1,\n    offset: 0,\n    source: template,\n    originalSource: template,\n  };\n}\nfunction getCursor(context) {\n  let { line, column, offset } = context;\n  return { line, column, offset };\n}\n// \u6BCF\u6B21\u622A\u53D6\u5B8C\u90FD\u8981\u53BB\u66F4\u65B0\u884C\u5217\u504F\u79FB\u91CF\u7B49\u4FE1\u606F\nfunction advancePositionWithMutation(context, source, endIndex) {\n  let linesCount = 0; // \u9047\u5230\u56DE\u8F66\u4F1A+1\n  let linePos = -1;\n  for (let i = 0; i < endIndex; i++) {\n    if (source.charCodeAt(i) === 10) {\n      linesCount++;\n      linePos = i;\n    }\n  }\n  context.line += linesCount;\n  context.column =\n    linePos === -1 ? context.column + endIndex : endIndex - linePos;\n  context.offset += endIndex;\n}\nfunction advanceBy(context, endIndex) {\n  let source = context.source;\n  // \u6BCF\u6B21\u5220\u6389\u5185\u5BB9\u90FD\u9700\u8981\u66F4\u65B0\u6700\u65B0\u7684\u884C\u5217\u4FE1\u606F\n  advancePositionWithMutation(context, source, endIndex);\n  context.source = source.slice(endIndex);\n}\n\nfunction parseTextData(context, endIndex) {\n  const rawText = context.source.slice(0, endIndex);\n  // \u5220\u6389\u5B57\u7B26\u4E32\n  advanceBy(context, endIndex);\n  // debugger;\n  return rawText;\n}\nfunction getSelection(context, start, end?) {\n  end = end || getCursor(context);\n\n  return {\n    start,\n    end,\n    source: context.originalSource.slice(start.offset, end.offset),\n  };\n}\n// \u89E3\u6790\u6587\u672C\nfunction parseText(context) {\n  // \u89E3\u6790\u6587\u672C\u7684\u65F6\u5019\uFF0C\u8981\u770B\u4EC0\u4E48\u65F6\u5019\u7ED3\u675F\n  const endTokens = [\"<\", \"{{\"];\n  let endIndex = context.source.length; // \u9ED8\u8BA4\u6587\u672C\u5230\u6700\u540E\u7ED3\u675F\n  for (let i = 0; i < endTokens.length; i++) {\n    let index = context.source.indexOf(endTokens[i], 1);\n    if (index !== -1 && endIndex > index) {\n      endIndex = index;\n    }\n  }\n  // \u521B\u5EFA\u884C\u5217\u4FE1\u606F\n  const start = getCursor(context);\n  // \u53D6\u5185\u5BB9\n  const content = parseTextData(context, endIndex);\n\n  return {\n    type: NodeTypes.TEXT,\n    content,\n    loc: getSelection(context, start),\n  };\n}\nfunction isEnd(context) {\n  const source = context.source;\n  if (context.source.startsWith(\"</\")) {\n    return true;\n  }\n  // \u5B57\u7B26\u4E32\u4E3A\u7A7A\u4E32\u5C31\u89E3\u6790\u5B8C\u6210\n  return source.length === 0;\n}\nfunction parseInterpolation(context) {\n  const start = getCursor(context);\n  const closeIndex = context.source.indexOf(\"}}\", \"{{\".length);\n  advanceBy(context, 2);\n\n  const innerStart = getCursor(context);\n  const innerEnd = getCursor(context);\n\n  const rawContentLength = closeIndex - 2;\n\n  let preContent = parseTextData(context, rawContentLength);\n  let content = preContent.trim();\n  let startOffset = preContent.indexOf(content);\n  if (startOffset > 0) {\n    // \u8BF4\u660E\u53CC\u5927\u62EC\u53F7\u6587\u672C\u4E4B\u524D\u6709\u7A7A\u683C\n    advancePositionWithMutation(innerStart, preContent, startOffset);\n  }\n  let endOffset = startOffset + content.length;\n  advancePositionWithMutation(innerEnd, preContent, endOffset);\n\n  advanceBy(context, 2);\n\n  return {\n    type: NodeTypes.INTERPOLATION,\n    content: {\n      type: NodeTypes.SIMPLE_EXPRESSION,\n      content,\n      loc: getSelection(context, innerStart, innerEnd),\n    },\n    loc: getSelection(context, start),\n  };\n}\nfunction advanceBySpaces(context) {\n  // \u7A7A\u683C\n  const match = /^[ \\t\\r\\n]+/.exec(context.source);\n  if (match) {\n    // \u6709\u7A7A\u683C\n    advanceBy(context, match[0].length);\n  }\n}\nfunction parseAttributeValue(context) {\n  const start = getCursor(context);\n  const quote = context.source[0];\n  let content;\n  if (quote === '\"' || quote === \"'\") {\n    advanceBy(context, 1);\n    // \u627E\u5230\u7ED3\u675F\u7684\u5F15\u53F7\n    const endIndex = context.source.indexOf(quote);\n    content = parseTextData(context, endIndex);\n    advanceBy(context, 1);\n  }\n  return {\n    content,\n    loc: getSelection(context, start),\n  };\n}\nfunction parseAttribute(context) {\n  const start = getCursor(context);\n  const match = /^[^\\t\\r\\n\\f />][^\\t\\r\\n\\f />=]*/.exec(context.source);\n  let name = match[0];\n  advanceBy(context, name.length);\n  advanceBySpaces(context);\n  advanceBy(context, 1);\n  // \"\" ''\n  let value = parseAttributeValue(context);\n  const loc = getSelection(context, start);\n  // debugger;\n  return {\n    type: NodeTypes.ATTRIBUTE,\n    name,\n    value: {\n      type: NodeTypes.TEXT,\n      // content: value.content,\n      ...value,\n    },\n    loc,\n  };\n}\nfunction parseAttributes(context) {\n  const props = [];\n  while (context.source.length > 0 && !context.source.startsWith(\">\")) {\n    const prop = parseAttribute(context);\n    props.push(prop);\n    advanceBySpaces(context);\n  }\n  return props;\n}\nfunction parseTag(context) {\n  const start = getCursor(context);\n  const match = /^<\\/?([a-z][^ \\t\\r\\n/>]*)/.exec(context.source);\n  const tag = match[1];\n  advanceBy(context, match[0].length);\n  advanceBySpaces(context);\n\n  let props = parseAttributes(context);\n  //  \u81EA\u95ED\u548C\u6807\u7B7E\n  let isSelfClosing = context.source.startsWith(\"/>\");\n  advanceBy(context, isSelfClosing ? 2 : 1);\n  return {\n    type: NodeTypes.ELEMENT,\n    tag,\n    isSelfClosing,\n    props,\n    children: [],\n    loc: getSelection(context, start),\n  };\n}\nfunction parseElement(context) {\n  // \u89E3\u6790\u6807\u7B7E <abc /> <aaa a='1'></aaa>\n  let ele = parseTag(context);\n  let children = parseChildren(context);\n  if (context.source.startsWith(\"</\")) {\n    parseTag(context);\n  }\n  ele.children = children;\n  ele.loc = getSelection(context, ele.loc.start);\n  return ele;\n}\nfunction parseChildren(context) {\n  const nodes = [];\n  while (!isEnd(context)) {\n    let node;\n    const source = context.source;\n    // \u53CC\u5927\u62EC\u53F7\u8868\u8FBE\u5F0F\n    if (source.startsWith(\"{{\")) {\n      node = parseInterpolation(context);\n    } else if (source[0] === \"<\") {\n      // \u6807\u7B7E\n      node = parseElement(context);\n    }\n    // \u6587\u672C\n    if (!node) {\n      node = parseText(context);\n    }\n\n    nodes.push(node);\n    // break;\n  }\n  return nodes;\n}\nfunction parse(template) {\n  // return template;\n  const context = createParserContext(template);\n  return parseChildren(context);\n}\nexport function compile(template) {\n  const ast = parse(template);\n  return ast;\n}\n"],
  "mappings": "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",
  "names": []
}
